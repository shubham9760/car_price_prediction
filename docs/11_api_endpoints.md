# API Endpoints

This document provides a comprehensive reference of all API endpoints, their methods, parameters, and responses.

## API Endpoints Overview

```mermaid
graph TD
    A["Flask API<br/>Port 5000"]
    
    A -->|Root| B["GET /"]
    B -->|Returns| B1["HTML homepage"]
    
    A -->|API Routes| C["/api"]
    C -->|Predict| C1["POST /api/predict/price"]
    C -->|Batch| C2["POST /api/predict/batch"]
    
    A -->|Info Routes| D["/info"]
    D -->|Status| D1["GET /info/status"]
    D -->|Features| D2["GET /info/features"]
    
    A -->|Docs| E["/api/docs"]
    E -->|Swagger| E1["Interactive API documentation<br/>Auto-generated by Flask-RESTX"]
    
    A -->|Health| F["Health check<br/>Port 5000"]
    F -->|Check| F1["GET / - Status 200"]
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style B1 fill:#fff9c4
    style C fill:#ffe0b2
    style C1 fill:#ffe0b2
    style C2 fill:#ffe0b2
    style D fill:#ffccbc
    style D1 fill:#ffccbc
    style D2 fill:#ffccbc
    style E fill:#ffb74d
    style E1 fill:#ffb74d
    style F fill:#b3e5fc
    style F1 fill:#b3e5fc
```

## Request/Response Model

```mermaid
graph TD
    A["Client Request"]
    -->|Send| B["HTTP Request<br/>POST /api/predict/price"]
    
    B -->|Body| C["JSON Payload"]
    C -->|Contains| C1["16 car features<br/>String, Int, Float"]
    
    C -->|Validate| D["Pydantic Schema<br/>PredictionRequest"]
    D -->|Check| D1["Type validation"]
    D -->|Check| D2["Range validation"]
    D -->|Check| D3["Required fields"]
    
    D -->|Valid| E["Process Request"]
    E -->|Load| E1["model.pkl"]
    E -->|Load| E2["scaler.pkl"]
    E -->|Load| E3["encoders.pkl"]
    
    E -->|Transform| F["Preprocess Data"]
    F -->|Encode| F1["Categorical features"]
    F -->|Scale| F2["Numerical features"]
    
    F -->|Predict| G["model.predict()"]
    G -->|Get| G1["Price (float)"]
    
    G1 -->|Format| H["JSON Response"]
    H -->|200 OK| I["{'price': value}"]
    
    D -->|Invalid| J["Validation Error"]
    J -->|422| K["Error Response<br/>Field errors detail"]
    
    I -->|Return| L["Response to Client"]
    K -->|Return| L
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style C fill:#fff9c4
    style C1 fill:#fff9c4
    style D fill:#ffe0b2
    style D1 fill:#ffe0b2
    style D2 fill:#ffe0b2
    style D3 fill:#ffe0b2
    style E fill:#ffccbc
    style E1 fill:#ffccbc
    style E2 fill:#ffccbc
    style E3 fill:#ffccbc
    style F fill:#ffccbc
    style F1 fill:#ffccbc
    style F2 fill:#ffccbc
    style G fill:#ffb74d
    style G1 fill:#ffb74d
    style H fill:#b3e5fc
    style I fill:#b3e5fc
    style J fill:#ef5350
    style K fill:#ef5350
    style L fill:#a5d6a7
```

## Single Prediction Endpoint

```mermaid
graph TD
    A["POST /api/predict/price<br/>Single Car Prediction"]
    
    subgraph "Request"
        B["Content-Type: application/json<br/>Body: 16 features"]
        B1["brand, model, year,<br/>mileage, engine_cc, power,<br/>transmission, fuel_type,<br/>owner_type, seats, new_used,<br/>plus 5 more fields"]
    end
    
    subgraph "Processing"
        C["Validate with<br/>PredictionRequest schema"]
        C -->|Check| C1["brand: string<br/>1-50 chars"]
        C -->|Check| C2["year: int<br/>1980-2023"]
        C -->|Check| C3["power: float<br/>20-500 bhp"]
    end
    
    subgraph "Response (Success)"
        D["Status: 200 OK<br/>Content-Type: application/json"]
        D -->|Body| D1["{<br/>  'price': 1250000.00<br/>}"]
    end
    
    subgraph "Response (Error)"
        E["Status: 422 Unprocessable<br/>Validation Error"]
        E -->|Body| E1["{<br/>  'detail': [{<br/>    'loc': ['body', 'power'],<br/>    'msg': 'value not in range',<br/>    'type': 'value_error'<br/>  }]<br/>}"]
    end
    
    A -->|Structure| B & B1
    B -->|Validation| C
    C -->|Each field| C1 & C2 & C3
    C -->|Success| D & D1
    C -->|Failure| E & E1
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style B1 fill:#fff9c4
    style C fill:#ffe0b2
    style C1 fill:#ffe0b2
    style C2 fill:#ffe0b2
    style C3 fill:#ffe0b2
    style D fill:#a5d6a7
    style D1 fill:#a5d6a7
    style E fill:#ef5350
    style E1 fill:#ef5350
```

## Batch Prediction Endpoint

```mermaid
graph TD
    A["POST /api/predict/batch<br/>Batch Car Predictions"]
    
    B["Content-Type: application/json<br/>Body: Array of car objects<br/>Multiple predictions at once"]
    
    B -->|Request| C["[<br/>  {16 features for car 1},<br/>  {16 features for car 2},<br/>  ...<br/>]"]
    
    C -->|Process| D["Validate each car<br/>using PredictionRequest"]
    
    D -->|Train| D1["Car 1 valid"]
    D -->|Train| D2["Car 2 valid"]
    D -->|Train| D3["... car N valid"]
    
    D1 -->|Predict| E1["Price 1"]
    D2 -->|Predict| E2["Price 2"]
    D3 -->|Predict| E3["Price N"]
    
    E1 -->|Response| E["Status: 200 OK<br/>Array of prices"]
    E2 -->|Response| E
    E3 -->|Response| E
    
    E -->|Body| E4["[<br/>  {'price': 1250000},<br/>  {'price': 850000},<br/>  ...<br/>]"]
    
    D -->|Partial Error| F["Invalid car(s)"]
    F -->|Response| F1["Status: 422<br/>Field error details"]
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style C fill:#fff9c4
    style D fill:#ffe0b2
    style D1 fill:#ffe0b2
    style D2 fill:#ffe0b2
    style D3 fill:#ffe0b2
    style E1 fill:#ffccbc
    style E2 fill:#ffccbc
    style E3 fill:#ffccbc
    style E fill:#a5d6a7
    style E4 fill:#a5d6a7
    style F fill:#ef5350
    style F1 fill:#ef5350
```

## Status Information Endpoint

```mermaid
graph TD
    A["GET /info/status<br/>API Health Status"]
    
    B["Request"]
    B -->|Method| B1["GET"]
    B -->|URL| B2["/info/status"]
    B -->|Body| B3["None"]
    
    B -->|Response| C["Status: 200 OK"]
    C -->|Body| C1["{<br/>  'status': 'healthy',<br/>  'model_loaded': true,<br/>  'scaler_loaded': true,<br/>  'encoders_loaded': true,<br/>  'timestamp': '2024-01-15T10:30:45Z'<br/>}"]
    
    B -->|Used For| D["Health checks<br/>Docker container<br/>Load balancer"]
    
    D -->|Every| E["30 seconds<br/>by Docker"]
    E -->|If healthy| F["✓ Status 200<br/>Container lives"]
    E -->|If unhealthy| G["✗ Status 500<br/>Container restarts"]
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style B1 fill:#fff9c4
    style B2 fill:#fff9c4
    style B3 fill:#fff9c4
    style C fill:#ffe0b2
    style C1 fill:#ffe0b2
    style D fill:#ffccbc
    style D fill:#ffccbc
    style E fill:#ffb74d
    style F fill:#a5d6a7
    style G fill:#ef5350
```

## Features Information Endpoint

```mermaid
graph TD
    A["GET /info/features<br/>Feature Importance Info"]
    
    B["Request"]
    B -->|Method| B1["GET"]
    B -->|URL| B2["/info/features"]
    B -->|Body| B3["None"]
    
    B -->|Response| C["Status: 200 OK"]
    C -->|Body| C1["{<br/>  'features': {<br/>    'Power': 0.285,<br/>    'Engine CC': 0.195,<br/>    'Year': 0.165,<br/>    'Mileage': 0.145,<br/>    'Brand': 0.125,<br/>    ...<br/>  }<br/>}"]
    
    C1 -->|Sorted| D["Descending order<br/>Highest importance first"]
    
    B -->|Used For| E["UI/Dashboard<br/>Feature ranking display<br/>Model interpretation"]
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style B1 fill:#fff9c4
    style B2 fill:#fff9c4
    style B3 fill:#fff9c4
    style C fill:#ffe0b2
    style C1 fill:#ffe0b2
    style D fill:#ffccbc
    style E fill:#ffb74d
```

## API Documentation Endpoint

```mermaid
graph TD
    A["GET /api/docs<br/>Swagger UI Documentation"]
    
    B["Request"]
    B -->|Method| B1["GET"]
    B -->|URL| B2["/api/docs"]
    B -->|Response| B3["HTML page<br/>Interactive Swagger UI"]
    
    B3 -->|Features| C["Endpoint listing<br/>with methods"]
    B3 -->|Features| D["Request body<br/>examples"]
    B3 -->|Features| E["Response format<br/>examples"]
    B3 -->|Features| F["Try it out<br/>Test endpoints"]
    
    C -->|Shows| G["POST /api/predict/price<br/>POST /api/predict/batch<br/>GET /info/status<br/>GET /info/features"]
    
    F -->|Click| H["'Try it out'<br/>button"]
    H -->|Enter| I["Test data"]
    I -->|Click| J["'Execute'"]
    J -->|See| K["Live response<br/>from API"]
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style B1 fill:#fff9c4
    style B2 fill:#fff9c4
    style B3 fill:#fff9c4
    style C fill:#ffe0b2
    style D fill:#ffe0b2
    style E fill:#ffe0b2
    style F fill:#ffe0b2
    style G fill:#ffccbc
    style H fill:#ffccbc
    style I fill:#ffb74d
    style J fill:#ffb74d
    style K fill:#b3e5fc
```

## HTTP Methods & Status Codes

```mermaid
graph TD
    subgraph "Methods"
        A["GET - Retrieve data<br/>No side effects<br/>Idempotent"]
        B["POST - Create/Process<br/>Side effects<br/>Send data in body"]
    end
    
    subgraph "Success Codes"
        C["200 OK<br/>Successful request"]
        D["201 Created<br/>Resource created"]
    end
    
    subgraph "Error Codes"
        E["400 Bad Request<br/>Invalid request format"]
        F["422 Unprocessable Entity<br/>Validation error<br/>Invalid field values"]
        G["404 Not Found<br/>Endpoint not found"]
        H["500 Internal Error<br/>Server error"]
    end
    
    A -->|Used by| I["GET /info/status<br/>GET /info/features<br/>GET /api/docs"]
    
    B -->|Used by| J["POST /api/predict/price<br/>POST /api/predict/batch"]
    
    J -->|Returns| C
    J -->|Returns| F
    
    I -->|Returns| C
    
    style A fill:#fff9c4
    style B fill:#fff9c4
    style C fill:#a5d6a7
    style D fill:#a5d6a7
    style E fill:#ef5350
    style F fill:#ef5350
    style G fill:#ef5350
    style H fill:#ef5350
    style I fill:#ffe0b2
    style J fill:#ffe0b2
```

## Error Handling Flow

```mermaid
graph TD
    A["Request received"]
    -->|Validate| B["Pydantic validation"]
    
    B -->|Type Error| C["Field has wrong type<br/>e.g., string for int"]
    C -->|Return| C1["Status 422<br/>Type error message"]
    
    B -->|Range Error| D["Field outside valid range<br/>e.g., year > 2023"]
    D -->|Return| D1["Status 422<br/>Range error message"]
    
    B -->|Missing Field| E["Required field missing"]
    E -->|Return| E1["Status 422<br/>Missing field message"]
    
    B -->|Valid| F["Process request"]
    F -->|Load model| G["Model available"]
    G -->|Predict| H["Get prediction"]
    
    G -->|Model error| I["Model failed to load"]
    I -->|Return| I1["Status 500<br/>Model error"]
    
    F -->|Predict error| J["Prediction failed"]
    J -->|Return| J1["Status 500<br/>Prediction error"]
    
    H -->|Return| K["Status 200<br/>Prediction result"]
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style C fill:#ffccbc
    style C1 fill:#ef5350
    style D fill:#ffccbc
    style D1 fill:#ef5350
    style E fill:#ffccbc
    style E1 fill:#ef5350
    style F fill:#ffe0b2
    style G fill:#ffe0b2
    style H fill:#ffe0b2
    style I fill:#ffb74d
    style I1 fill:#ef5350
    style J fill:#ffb74d
    style J1 fill:#ef5350
    style K fill:#a5d6a7
```

## Request Example Sequence

```mermaid
sequenceDiagram
    participant Client
    participant API as Flask API
    participant Model as Model
    participant Response
    
    Client->>API: POST /api/predict/price
    Client->>API: Content-Type: application/json
    Client->>API: Body: {16 features}
    
    API->>API: Pydantic validation
    API->>API: Type checks pass ✓
    API->>API: Range checks pass ✓
    
    API->>Model: Load model.pkl
    Model-->>API: Model loaded
    
    API->>Model: Preprocess features
    Model-->>API: Features preprocessed
    
    API->>Model: predict(features)
    Model-->>API: Price: 1,250,000
    
    API->>Response: Create JSON response
    Response-->>Client: Status 200
    Response-->>Client: {'price': 1250000}
```

---

## API Endpoints Summary Table

| Endpoint | Method | Purpose | Input | Output | Status |
|----------|--------|---------|-------|--------|--------|
| `/` | GET | Home page | None | HTML | 200 |
| `/api/predict/price` | POST | Single prediction | 16 fields | Price | 200/422 |
| `/api/predict/batch` | POST | Batch prediction | Array | Prices array | 200/422 |
| `/info/status` | GET | Health check | None | Status JSON | 200 |
| `/info/features` | GET | Feature importance | None | Features JSON | 200 |
| `/api/docs` | GET | Swagger UI | None | HTML docs | 200 |

**Total Endpoints:** 6 (5 functional + 1 documentation)  
**Primary Methods:** GET, POST  
**Response Format:** JSON (except home and docs)  
**Auth:** None (public API)  

